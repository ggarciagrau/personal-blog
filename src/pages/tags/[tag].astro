---
import BaseLayout from "../../layouts/BaseLayout..astro";
import BlogPost from "../../components/BlogPost.astro";

import type { GetStaticPaths } from "astro";

export const getStaticPaths = (async () => {
  const allPosts: any[] = await Astro.glob("../posts/*.md");

  const currentTags = allPosts.map(({ frontmatter }) => frontmatter.tags);

  const allUniqueTags: any[] = [...new Set(currentTags.flat())]

  return allUniqueTags.map((tag) => ({
    params: { tag },
    props: { posts: allPosts },
  }));
}) satisfies GetStaticPaths;

const { tag } = Astro.params;
const { posts } = Astro.props;

const filteredPosts = posts.filter(({ frontmatter: { tags } }) =>
  tags.includes(tag)
);
---

<BaseLayout pageTitle={tag}>
  <h2>Posts tagged with <i>{tag}</i></h2>
  {filteredPosts.map((post) => <BlogPost post={post} />)}
</BaseLayout>
